<!DOCTYPE html>
<html lang="in">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="theme-color" content="#336fca"/>
    <meta property="og:title" content="Buat Artikel">
    <meta property="og:description" content="Buat Artikel Di Sini Ya!">
    <meta property="og:image" content="https://i.imgur.com/ZykwwOE.jpeg">
    <link rel="shortcut icon" href="https://i.imgur.com/ggIjVZ6.jpeg" type="image/x-icon">
    <link rel="stylesheet" href="style3.css">
    <script src="https://kit.fontawesome.com/55100b01de.js" crossorigin="anonymous"></script>
    <script src="script.js"></script>
    <title>Buat Artikel</title>
</head>
<body>    
    <header id="headerartikel">
        <div class="headermenu">
            <a class="barsbut" id="opennavigasi"><i id="buttonsidebari" class="fa fa-bars"></i></a>
            <img src="logoartikel.png" alt="Logo G90 Artikel PNG - Latar Belakang">
            <a href="search.html" class="whatsappbut"><i class="fa fa-search"></i></a>
        </div>
        <div id="sidebarnav" class="sidebarnav">
            <div id="menuheader" class="menuheader">
                <a id="closenavigasi" style="float: left; font-size: 20px;"><i class="fa fa-times"></i></a>
                <a href="../report.html" style="float: right;"><i class="fa fa-exclamation-circle"></i></a>
            </div>
            <p>G90-NF</p>
            <a href="../home.html"><i class="fa fa-home"></i> Home</a>
            <a href="../rules.html"><i class="fa fa-scroll"></i> Rules</a>
            <a href="../admin.html"><i class="fa fa-person"></i> Admin</a>
            <a href="../news.html"><i class="fa fa-newspaper"></i> News</a>
            <a href="../event.html"><i class="fa fa-calendar-day"></i> Event</a>
            <a href="../game.html"><i class="fa fa-gamepad"></i> Games</a>
        </div>
        <div class="barsdesktop">
            <ul>
                <img src="logoartikel.png" alt="Logo G90 Artikel PNG - Latar Belakang">
                <li><a class="menuhalaman" href="home.html">Home</a></li>
                <li><a class="menuhalaman" href="rules.html">Rules</a></li>
                <li><a class="menuhalaman" href="admin.html">Admin</a></li>
                <li><a class="menuhalaman" href="news.html">News</a></li>
                <li><a class="menuhalaman" href="event.html">Event</a></li>
                <li><a class="menuhalaman" href="game.html">Games</a></li>
                <li><a class="submenu" href="report.html"><i class="fa fa-exclamation-circle"></i></a></li>
                <li><a class="submenu" href="search.html"><i class="fa fa-search"></i></a></li>
        </div>
    </header>
    
    
    <div class="container">
    <h1>Editor Blog</h1>
    <p>Ada yang perlu di tanyakan? langsung cuss dm gw</p><a href="https://wa.me/6285768019887">Butuh Bantuan</a>
    
    <div id="editorMode">
        <div class="toolbar">
            <button onclick="insertTag('h1')">Judul</button>
            <button onclick="insertTag('p')">Text Bebas</button>
            <button onclick="insertImg()">Image</button>
            <button onclick="insertLink()">Tombol</button>
            <button onclick="insertIframe()">Iframe</button>
        </div>

        <div>
            <textarea style="border: 2px solid #000;" id="editor" placeholder="Tulis code artikel gunakan coding html..." rows="30" cols="50"></textarea>
        </div>
    </div>

    <div id="previewMode" style="display: none;">
        <h2>Preview:</h2>
        <div id="previewContent" class="previewcontent">
            
        </div>
    </div>
       
        <button onclick="toggleMode()">Preview</button><br>
   
    <!-- Tombol untuk memposting -->
       <input type="text" id="title" placeholder="Judul Artikel"><br>
       <input type="text" id="deskripsi" placeholder="Deskripsi Artikel"><br>
       <button onclick="publishPost()">Posting</button>
    </div>
    
    
    
    
    
    <section id="akhiran" class="akhiran">
        <h1>G90NF</h1>
        <p>G90 adalah grup negara fiksi kelas menengah dengan jumlah anggota 100+,organisasi di buat dengan tujuan Ekonomi,pertahanan,pembangunan,dan komunikasi atau kerjasama antar negara fiksi 
Organisasi ini di buat pada tanggal 17 Juni 2022</p>
        <div class="contentakhiran">
            <p>Project</p>
            <a href="g90nf.apk">Download</a>
            <a href="">Refresh</a>
        </div>
        <div class="contentakhiran">
            <p>Suport</p>
            <a href="https://kezt.id">Kezt</a>
            <a href="https://chat.whatsapp.com/H0twEacfDpC3kfW33zX0HS">Contact</a>
        </div>
        <section class="sosialmedia">
            <a href="https://youtube.com/@G90negarafiksiOfficial?si=8r9YAZ20dHn5ch7E"><i class="fa fa-youtube"></i></a>
            <a href="https://chat.whatsapp.com/H0twEacfDpC3kfW33zX0HS"><i class="fa fa-whatsapp"></i></a>
            <a href="https://www.tiktok.com/@g90_official_negarafiksi?_t=8kf4rqA35dv&_r=1"><i class="fa-brands fa-tiktok"></i></a>
        </section>
        <p>Â©G90NegaraFiksi</p>
    </section>
    
    <script>
        
    
    let isPreviewMode = false;

    function toggleMode() {
        isPreviewMode = !isPreviewMode;
        if (isPreviewMode) {
            document.getElementById('editorMode').style.display = 'none';
            document.getElementById('previewMode').style.display = 'block';
            // Tampilkan konten dari editor sebagai HTML di preview
            document.getElementById('previewContent').innerHTML = document.getElementById('editor').value;
        } else {
            document.getElementById('editorMode').style.display = 'block';
            document.getElementById('previewMode').style.display = 'none';
        }
    }

    function insertTag(tagName) {
        const editor = document.getElementById('editor');
        const cursorPosition = editor.selectionStart;
        const content = editor.value;
        const newContent = content.slice(0, cursorPosition) + '<' + tagName + '></' + tagName + '>' + content.slice(cursorPosition);
        editor.value = newContent;
    }
    
    function insertImg() {
        const url = prompt('Masukkan URL link image dengan awalan https://');
        const namaalt = prompt('Masukkan Deskripsi Gambar');
    
    if (url) {
        const editor = document.getElementById('editor');
        const cursorPosition = editor.selectionStart;
        const content = editor.value;
        const newContent = content.slice(0, cursorPosition) + '<img src="' + url + '" alt="' + namaalt + '" >' + content.slice(cursorPosition);
        editor.value = newContent;
    }
}

    function insertLink() {
        const url = prompt('Masukkan URL link dengan awalan https://');
        const namatombol = prompt('Masukkan nama untuk tombol bebas namanya');
        
        if (url) {
            const editor = document.getElementById('editor');
            const cursorPosition = editor.selectionStart;
            const content = editor.value;
            const newContent = content.slice(0, cursorPosition) + '<a href="' + url + '">' + namatombol + '</a>' + content.slice(cursorPosition);
            editor.value = newContent;
        }
    }
    
    function insertIframe() {
        const url = prompt('Masukkan URL link dengan awalan https://');
        
        if (url) {
            const editor = document.getElementById('editor');
            const cursorPosition = editor.selectionStart;
            const content = editor.value;
            const newContent = content.slice(0, cursorPosition) + '<iframe style="border: none; outline: none; width: 100%; height: 200px;" src="' + url + '">Loading...</iframe>' + content.slice(cursorPosition);
            editor.value = newContent;
        }
    }
    
    
    let isPostingClicked = false; // Menyimpan status tombol Posting

async function publishPost() {
    // Mendapatkan nilai judul dan konten dari input
    const title = document.getElementById('title').value;
    const deskripsi = document.getElementById('deskripsi').value;
    const content = document.getElementById('editor').value;
    const headerContent = document.getElementById('headerartikel').outerHTML;
    const akhiranContent = document.getElementById('akhiran').outerHTML;

    // Validasi input
    if (title === '' || content === '') {
        alert('Judul dan konten tidak boleh kosong.');
        return; // Menghentikan proses jika input kosong
    }

    // Mengatur status tombol Posting
    if (!isPostingClicked) {
        isPostingClicked = true;
        alert('Klik tombol Posting sekali lagi untuk memposting.'); // Memberikan peringatan untuk klik kedua
        return;
    }

    // Melakukan proses posting setelah tombol Posting ditekan dua kali
    const htmlFileName = generateHTMLFileName(title);
    const username = 'g90nf';
    const repository = 'g90nf.github.io';
    const token = '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';

    try {
        const htmlContent = `<!DOCTYPE html>
                        <html lang="en">
                        <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <meta name="theme-color" content="#336fca"/>
                        <meta property="og:title" content="${title}">
                        <meta property="og:description" content="${deskripsi}">
                        <meta property="og:image" content="https://i.imgur.com/ZykwwOE.jpeg">
                        <title>${title}</title>
                        <link rel="stylesheet" href="style3.css">
                        <script src="https://kit.fontawesome.com/55100b01de.js" crossorigin="anonymous"></${'script'}>
                        <script src="script.js"></${'script'}>
                        </head>
                        <body>${headerContent}${content}${akhiranContent}</body>
                        </html>`;
        
        const response = await fetch('https://api.github.com/repos/' + username + '/' + repository + '/contents/artikel/' + htmlFileName, {
            method: 'PUT',
            headers: {
                'Authorization': 'token ' + token,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                message: 'Update post',
                content: btoa(unescape(encodeURIComponent(htmlContent))),
            }),
        });
        
        if (response.ok) {
        
        } else {
            const responseData = await response.json();
            if (responseData.message === 'Bad credentials') {
                alert('Gagal menerbitkan post. Token akses GitHub tidak valid.');
            } else if (responseData.message === 'This repository already has a file named ' + htmlFileName) {
                alert('Gagal menerbitkan post. Nama file sudah ada.');
            } else {
                alert('Gagal menerbitkan post. Silakan coba lagi.');
            }
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Terjadi kesalahan. Silakan coba lagi.');
    } finally {
        // Setelah proses selesai, kembalikan status tombol Posting menjadi false untuk penggunaan selanjutnya
        isPostingClicked = false;
    }
}

    function generateHTMLFileName(title) {
        let lowercaseTitle = title.toLowerCase();
        let fileName = lowercaseTitle.replace(/\s+/g, '-');
        fileName = fileName.replace(/[^a-z0-9-_]/g, '');
        fileName += '.html';
        return fileName;
    }
        
    </script>
</body>
</html>
